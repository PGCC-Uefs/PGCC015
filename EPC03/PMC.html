<!DOCTYPE html>
<html lang="pt-br">
   <head>
        <meta charset="utf-8"/>
        <meta http-equiv="cache-control" content="max-age=0" />
        <meta http-equiv="cache-control" content="no-cache" />
        <meta http-equiv="expires" content="0" />
        <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT" />
        <meta http-equiv="pragma" content="no-cache" />
        <title>Perceptron Multicamadas - EPC03 - PGCC 2020.1</title>
        <script src="PMC.js"></script>
        <script>
        function rodar(){
            console.clear();
            var neuronio = new pmc();
            fileSelected = document.getElementById('txtfiletoread');
            fileExtension = /.*/; //application/octet-stream //zz-application/zz-winassoc-dat
            fileTobeRead = fileSelected.files[0];
                    if(fileTobeRead != undefined){
                        console.log("Mime type: "+fileTobeRead.type);        
                        if (fileTobeRead.type.match(fileExtension)) {
                            var fileReader = new FileReader();
                            fileReader.onload = function () {
                                var array = fileReader.result.split(/\r\n|\n/);
                                var amostras = [];
                                var classes = [];
                                var y = array.indexOf("@data")+1;
                                var x = 0;
                                var z = 0;
                                while(y<array.length){
                                        let arraySlipt = array[y].split(",");
                                        let inputs = arraySlipt;
                                        let outputString = arraySlipt.pop().trim().toString();
                                        let outputSplit = outputString.split("");
                                        outputSplit = outputSplit.map(x => x.charCodeAt(0));
                                        var output = outputSplit.reduce(function(output, valor){
                                            return output + valor;
                                        }, 0);
                                        amostras[x] =   {
                                                            inputs: inputs, 
                                                            output: output
                                                        };
                                        if(!classes.includes(outputString) && outputString != ""){
                                            classes[z]=outputString;
                                            z++;
                                        }
                                        y++;
                                        x++;
                                }
                                console.log(classes);
                                if(amostras[parseInt(x-1)].inputs.length == 0){amostras.pop();}
                                neuronio.iniciar(0.1, 100000);
                                // aqui, laço executando o treinamento pelo número de entradas da amostra, inputs.length
                                neuronio.treinamento(amostras);
                                var camadaInicial = 0;
                                var teste = [
                                                {inputs: [5.1, 3.5, 1.4, 0.2]} // ler o arquivo .dat
                                            ];
                                var i = 0;
                                console.log("Resultado: " + neuronio.executar([5.1, 3.5, 1.4, 0.2],camadaInicial));
                                console.log("Epocas: " + neuronio.showEpocas);
                                while(i < teste.length){
                                    console.log("Amostra "+(i+1)+" Y: " + neuronio.u + " Saída: " + neuronio.executar(teste[i].inputs),camadaInicial);
                                    i++;
                                }
                                console.log("Epocas: " + neuronio.showEpocas);
                            }
                            fileReader.readAsText(fileTobeRead);
                        }
                        else {
                            alert("Por favor selecione arquivo texto");
                        }
                    }
                    else {
                        alert("Por favor selecione um arquivo");
                    }
        }
        </script>
    </head>
    <body>
        Selecione o arquivo .dat:
        <input type="file" id="txtfiletoread" /><br />
        <button onclick="rodar();">Executar</button><br>
        <div>Conteúdo do arquivo:</div>
        <div id="filecontents">
        </div>
    </body>
</html>
