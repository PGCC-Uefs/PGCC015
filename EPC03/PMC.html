<!DOCTYPE html>
<html lang="pt-br">
   <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
        <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
        <meta charset="utf-8"/>
        <meta http-equiv="cache-control" content="max-age=0" />
        <meta http-equiv="cache-control" content="no-cache" />
        <meta http-equiv="expires" content="0" />
        <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT" />
        <meta http-equiv="pragma" content="no-cache" />
        <title>Perceptron Multicamadas - EPC03 - PGCC 2020.1</title>
        <script src="PMC.js"></script>
        <script>
        function rodar(){
            console.clear();
            var neuronio = new pmc();
            fileSelected = document.getElementById('txtfiletoread');
            fileExtension = /.*/; //application/octet-stream //zz-application/zz-winassoc-dat
            fileTobeRead = fileSelected.files[0];
                    if(fileTobeRead != undefined){
                        console.log("Mime type: "+fileTobeRead.type);        
                        if (fileTobeRead.type.match(fileExtension)) {
                            var fileReader = new FileReader();
                            fileReader.onload = function () {
                                var array = fileReader.result.split(/\r\n|\n/);
                                var y = array.indexOf("@data")+1;
                                var amostras = [];
                                var classes = {keys: [],values: []};
                                var x = 0;
                                var z = 0;
                                while(y<array.length){
                                        var arraySlipt = array[y].replace(/\s/g, '').split(",");
                                        var inputs = arraySlipt;
                                        var outputString = arraySlipt.pop().trim().toString();
                                        if(typeof outputString.match(/[a-z]|[A-Z]/g) != null){  // se output for alfanumérico
                                            var outputSplit = outputString.split("");
                                            outputSplit = outputSplit.map(x => x.charCodeAt(0));
                                            var output = outputSplit.reduce(function(output, valor){
                                                return (output + valor);
                                            }, 0);
                                            if(classes["keys"].indexOf(output) === -1){
                                                classes["keys"].push(output);
                                                classes["values"].push(outputString);
                                            }
                                            output = classes["keys"].indexOf(output)+1;
                                        }
                                        else{
                                            var output = outputString; // se output for numérico
                                        }
                                        inputs.unshift(neuronio.bias);
                                        amostras[x] =   {
                                                            inputs: inputs, 
                                                            output: output
                                                        };
                                        y++;
                                        x++;
                                }
                                if(amostras[parseInt(x-1)].inputs.length < 2){amostras.pop();}
                                document.getElementById("filecontents").innerHTML = JSON.stringify(amostras);
                                var entradas = amostras[0].inputs.length;
                                var topologia = [3,4,1]; // número de camadas e neurônios da rede
                                var txAprendizagem = 0.1;
                                neuronio.iniciar(txAprendizagem,topologia,classes);
                                neuronio.treinamento(amostras);
                                var i = 0;
                                var teste = [
                                                {inputs: [6.0, 3.4, 4.5, 1.6]} // ler o arquivo .dat
                                            ];
                                while(i < teste.length){
                                    console.log("Amostra Y"+(i+1)+": " + JSON.stringify(neuronio.executar(teste[i])));
                                    i++;
                                }
                            }
                            fileReader.readAsText(fileTobeRead);
                        }
                        else {
                            alert("Por favor selecione arquivo texto");
                        }
                    }
                    else {
                        alert("Por favor selecione um arquivo");
                    }
        }
        </script>
    </head>
    <body>
        Selecione o arquivo .dat:
        <input type="file" id="txtfiletoread" /><br />
        <button onclick="rodar();">Iniciar Treinamento</button><br>
        <div>Conteúdo do arquivo:</div>
        <div id="filecontents">
        </div>
        <div id="dadosSaida">
            <p>
            EQM: <span id="eqm"></span><br>
            Erro: <span id="erro"></span><br>
            Epocas: <span id="epocas"></span><br>
            Tempo Execução: <span id="tempo"></span>ms
            </p>
        </div>
<!--         <canvas id="myChart" width="400" height="400"></canvas>
        <script>
        var ctx = document.getElementById('myChart').getContext('2d');
        var myChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: ['Red', 'Blue', 'Yellow', 'Green', 'Purple', 'Orange'],
                datasets: [{
                    label: '# of Votes',
                    data: [12, 19, 3, 5, 2, 3],
                    backgroundColor: [
                        'rgba(255, 99, 132, 0.2)',
                        'rgba(54, 162, 235, 0.2)',
                        'rgba(255, 206, 86, 0.2)',
                        'rgba(75, 192, 192, 0.2)',
                        'rgba(153, 102, 255, 0.2)',
                        'rgba(255, 159, 64, 0.2)'
                    ],
                    borderColor: [
                        'rgba(255, 99, 132, 1)',
                        'rgba(54, 162, 235, 1)',
                        'rgba(255, 206, 86, 1)',
                        'rgba(75, 192, 192, 1)',
                        'rgba(153, 102, 255, 1)',
                        'rgba(255, 159, 64, 1)'
                    ],
                    borderWidth: 1
                }]
            },
            options: {
                scales: {
                    yAxes: [{
                        ticks: {
                            beginAtZero: true
                        }
                    }]
                }
            }
        });
        </script> -->
    </body>
</html>
