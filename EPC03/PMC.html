<!DOCTYPE html>
<html lang="pt-br">
   <head>
        <meta charset="utf-8"/>
        <meta http-equiv="cache-control" content="max-age=0" />
        <meta http-equiv="cache-control" content="no-cache" />
        <meta http-equiv="expires" content="0" />
        <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT" />
        <meta http-equiv="pragma" content="no-cache" />
        <title>Perceptron Multicamadas - EPC03 - PGCC 2020.1</title>
        <script src="PMC.js"></script>
        <script>
        function rodar(){
            console.clear();
            var neuronio = new pmc();
            fileSelected = document.getElementById('txtfiletoread');
            fileExtension = /.*/; //application/octet-stream //zz-application/zz-winassoc-dat
            fileTobeRead = fileSelected.files[0];
                    if(fileTobeRead != undefined){
                        console.log("Mime type: "+fileTobeRead.type);        
                        if (fileTobeRead.type.match(fileExtension)) {
                            var fileReader = new FileReader();
                            fileReader.onload = function () {
                                var array = fileReader.result.split(/\r\n|\n/);
                                var y = array.indexOf("@data")+1;
                                var amostras = [];
                                var classes = {keys: [],values: []};
                                var x = 0;
                                var z = 0;
                                while(y<array.length){
                                        var arraySlipt = array[y].replace(/\s/g, '').split(",");
                                        var inputs = arraySlipt;
                                        var outputString = arraySlipt.pop().trim().toString();
                                        if(typeof outputString.match(/[a-z]|[A-Z]/g) != null){  // se output for alfanumérico
                                            var outputSplit = outputString.split("");
                                            outputSplit = outputSplit.map(x => x.charCodeAt(0));
                                            var output = outputSplit.reduce(function(output, valor){
                                                return (output + valor);
                                            }, 0);
                                            if(classes["keys"].indexOf(output) === -1){
                                                classes["keys"].push(output);
                                                classes["values"].push(outputString);
                                            }
                                            output = classes["keys"].indexOf(output)+1;
                                        }
                                        else{
                                            var output = outputString; // se output for numérico
                                        }
                                        amostras[x] =   {
                                                            inputs: inputs, 
                                                            output: output
                                                        };
                                        y++;
                                        x++;
                                }
                                if(amostras[parseInt(x-1)].inputs.length == 0){amostras.pop();}
                                var entradas = amostras[0].inputs.length;
                                var topologia = [entradas,3,2]; // número de camadas e neurônios da rede
                                neuronio.iniciar(0.1,topologia,classes);
                                neuronio.treinamento(amostras);
                                var i = 0;
                                var teste = [
                                                {inputs: [5.1, 3.5, 1.4, 0.2]} // ler o arquivo .dat
                                            ];
                                console.log("Epocas: " + neuronio.numEpocas);
                                while(i < teste.length){
                                    console.log("Amostra "+(i+1)+" Y: " + neuronio.u + " Saída: " + neuronio.executar(teste[i]));
                                    i++;
                                }
                                console.log("Epocas: " + neuronio.numEpocas);
                            }
                            fileReader.readAsText(fileTobeRead);
                        }
                        else {
                            alert("Por favor selecione arquivo texto");
                        }
                    }
                    else {
                        alert("Por favor selecione um arquivo");
                    }
        }
        </script>
    </head>
    <body>
        Selecione o arquivo .dat:
        <input type="file" id="txtfiletoread" /><br />
        <button onclick="rodar();">Executar</button><br>
        <div>Conteúdo do arquivo:</div>
        <div id="filecontents">
        </div>
    </body>
</html>
