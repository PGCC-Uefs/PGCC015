<!DOCTYPE html>
<html lang="pt-br">
   <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
        <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
        <meta charset="utf-8"/>
        <meta http-equiv="cache-control" content="max-age=0" />
        <meta http-equiv="cache-control" content="no-cache" />
        <meta http-equiv="expires" content="0" />
        <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT" />
        <meta http-equiv="pragma" content="no-cache" />
        <title>Perceptron Multicamadas - EPC03 - PGCC 2020.1</title>
        <script src="PMC.js"></script>
        <script>
        function filtrarArray(array){
            var retorno = array.filter(function (el) {
                return el != "";
            });
            return retorno;
        }
        function rodar(){
            console.clear();
            var neuronio = new pmc();
            var classes = [];
            fileSelected = document.getElementById('txtfiletoread');
            fileExtension = /.*/; //application/octet-stream //zz-application/zz-winassoc-dat
            fileTobeRead = fileSelected.files[0];
                    if(fileTobeRead != undefined){
                        console.log("Mime type: "+fileTobeRead.type);        
                        if (fileTobeRead.type.match(fileExtension)) {
                            var fileReader = new FileReader();
                            fileReader.onload = function () {
                                var array = fileReader.result.split(/\r\n|\n/);
                                var y = array.indexOf("@data")+1;
                                var relation = array[0];
                                var amostras = [];
                                var x = 0;
                                var z = 0;
                                while(y<array.length){
                                        var arraySlipt = array[y].replace(/\s/g, '').split(",");
                                        var outputString = arraySlipt.pop().trim().toString();
                                        var inputs = arraySlipt.map(x => parseFloat(x));
                                        if(classes.indexOf(outputString) === -1){
                                            classes.push(outputString);
                                        }
                                        amostras[x] =   {
                                                            inputs: inputs, 
                                                            output: outputString
                                                        };
                                        y++;
                                        x++;
                                }
                                
                                for(i=0;i<classes.length;i++){
                                    var bin = "";
                                    bin = bin.padStart(classes.length, "0").split("");
                                    bin[i]="1";
                                    bin = bin.join("");
                                    classes[i] = {
                                        output: classes[i],
                                        outputBin: bin
                                    };
                                }
                                for(k=0;k<amostras.length;k++){
                                    for(i=0;i<classes.length;i++){
                                        if(amostras[k].output == classes[i].output){amostras[k].output = classes[i].outputBin;}
                                    }
                                }
                                if(amostras[x-1].inputs.length == ""){amostras.pop();}
                                classes.pop();
                                document.getElementById("classes").innerHTML = JSON.stringify(classes);
                                document.getElementById("amostras").innerHTML = JSON.stringify(amostras);
                                var entrada = amostras[0].inputs.length;
                                var oculta = 4;
                                var saida = classes.length;
                                var topologia = [entrada,oculta,saida];
                                document.getElementById("topologia").innerText = JSON.stringify(topologia);
                                var txAprendizagem = 0.1;
                                neuronio.iniciar(txAprendizagem,topologia,classes);
                                neuronio.treinamento(amostras);
                                relation = relation.split(" ");


                                var i = 0;
                                var datasets = [{
                                    iris: [ 
                                    //iris
                                    {inputs: [5.0, 3.6, 1.4, 0.2]},
                                        {inputs: [4.8, 3.4, 1.6, 0.2]},
                                            {inputs: [5.4, 3.9, 1.3, 0.4]},
                                                {inputs: [5.1, 3.5, 1.4, 0.3]},
                                                    {inputs: [4.8, 3.4, 1.9, 0.2]},
                                                        {inputs: [5.2, 3.5, 1.5, 0.2]},
                                                            {inputs: [5.2, 3.4, 1.4, 0.2]},
                                                                {inputs: [4.5, 2.3, 1.3, 0.3]},
                                                                    {inputs: [5.1, 3.8, 1.9, 0.4]},
                                                                        {inputs: [6.1, 2.9, 4.7, 1.4]},
                                                                            {inputs: [5.6, 2.9, 3.6, 1.3]},
                                                                                {inputs: [6.7, 3.1, 4.4, 1.4]},
                                                                                    {inputs: [5.6, 2.5, 3.9, 1.1]},
                                                                                        {inputs: [5.9, 3.2, 4.8, 1.8]},
                                                                                            {inputs: [5.4, 3.0, 4.5, 1.5]},
                                                                                                {inputs: [6.1, 3.0, 4.6, 1.4]},
                                                                                                    {inputs: [5.8, 2.6, 4.0, 1.2]},
                                                                                                        {inputs: [5.7, 3.0, 4.2, 1.2]},
                                                                                                            {inputs: [6.2, 2.9, 4.3, 1.3]},
                                                                                                                {inputs: [7.6, 3.0, 6.6, 2.1]},
                                                                                                                    {inputs: [4.9, 2.5, 4.5, 1.7]},
                                                                                                                        {inputs: [6.7, 2.5, 5.8, 1.8]},
                                                                                                                            {inputs: [7.7, 2.8, 6.7, 2.0]},
                                                                                                                                {inputs: [6.3, 3.4, 5.6, 2.4]},
                                                                                                                                    {inputs: [6.9, 3.1, 5.4, 2.1]},
                                                                                                                                        {inputs: [6.7, 3.1, 5.6, 2.4]},
                                                                                                                                            {inputs: [6.8, 3.2, 5.9, 2.3]},
                                                                                                                                                {inputs: [6.7, 3.3, 5.7, 2.5]},
                                                                                                                                                    {inputs: [4.4, 3.2, 1.3, 0.2]},
                                                                                                                                                        {inputs: [6.0, 2.2, 5.0, 1.5]}

                                    ],
                                    glass: [ 
                                    //glass
                                        {inputs: [1.51588824, 12.87795, 3.43036, 1.40066, 73.282, 0.68931, 8.04468, 0.0, 0.1224]}, //1
                                        {inputs: [1.51839404, 12.85135, 3.66833, 1.24016, 72.5708, 0.621, 8.67952, 0.0, 0.1785]}, //2
                                        {inputs: [1.51663998, 13.1373, 3.44832, 1.76018, 72.4812, 0.60237, 8.37824, 0.0, 0.0867]} //3
                                    ],
                                    winequality: [ 
                                    //wine
                                        {inputs: [7.0,0.27,0.36,20.7,0.045,45.0,170.0,1.001,3.0,0.45,8.8]}, //6
                                        {inputs: [8.6,0.23,0.4,4.2,0.035,17.0,109.0,0.9947,3.14,0.53,9.7]}, //5
                                        {inputs: [6.2,0.66,0.48,1.2,0.029,29.0,75.0,0.9892,3.33,0.39,12.8]} //8
                                    ]
                                }];
                                var set = datasets[0][relation[1]];
                                neuronio.executar(set);
                            }
                            fileReader.readAsText(fileTobeRead);
                        }
                        else {
                            alert("Por favor selecione arquivo texto");
                        }
                    }
                    else {
                        alert("Por favor selecione um arquivo");
                    }
        }
        </script>
    </head>
    <body>
        Selecione o arquivo .dat:
        <input type="file" id="txtfiletoread" /><br />
        <button onclick="rodar();">Iniciar</button><br>
        <div id="dadosSaida">
            <p>
            Topologia: <span id="topologia"></span><br>
            Saída treinamento: <span id="saida"></span><br>
            EQM treinamento: <span id="eqm"></span><br>
            Erro treinamento: <span id="erro"></span><br>
            Epocas treinamento: <span id="epocas"></span><br>
            Tempo Execução treinamento: <span id="tempo"></span>ms
            </p>
        </div>
        <p id="classes"></p>
        <p id="amostras"></p>
<!--         <canvas id="myChart" width="400" height="400"></canvas>
        <script>
        var ctx = document.getElementById('myChart').getContext('2d');
        var myChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: ['Red', 'Blue', 'Yellow', 'Green', 'Purple', 'Orange'],
                datasets: [{
                    label: '# of Votes',
                    data: [12, 19, 3, 5, 2, 3],
                    backgroundColor: [
                        'rgba(255, 99, 132, 0.2)',
                        'rgba(54, 162, 235, 0.2)',
                        'rgba(255, 206, 86, 0.2)',
                        'rgba(75, 192, 192, 0.2)',
                        'rgba(153, 102, 255, 0.2)',
                        'rgba(255, 159, 64, 0.2)'
                    ],
                    borderColor: [
                        'rgba(255, 99, 132, 1)',
                        'rgba(54, 162, 235, 1)',
                        'rgba(255, 206, 86, 1)',
                        'rgba(75, 192, 192, 1)',
                        'rgba(153, 102, 255, 1)',
                        'rgba(255, 159, 64, 1)'
                    ],
                    borderWidth: 1
                }]
            },
            options: {
                scales: {
                    yAxes: [{
                        ticks: {
                            beginAtZero: true
                        }
                    }]
                }
            }
        });
        </script> -->
    </body>
</html>
